<!DOCTYPE html>
<html>
<head>  
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">


  <style>
  body, html {    
    height: 100%;
    width: 100%;
    background: #414142;
  }

  body { pa
    padding-top: 70px; 
  }

  nav {    
    padding-bottom: 70px;
  }

  .col-centered {
    display: block;
    margin-left: auto;
    margin-right: auto;
    text-align: center;
  }

  .row > div {
    /*margin-top:10px;*/
    padding: 10px;
    outline: 0.1px solid #000000;    
    color: #FFF;
    outline-offset: 0px;
    -moz-outline-radius: 10px;
    -webkit-outline-radius: 10px;
  } 

  .row-light {
    /*margin-top:10px;*/
    padding: 10px;
    outline: 0.1px solid #FFF;
    background: #414142;
    color:#a4a4a5;
    outline-offset: 0px;
    -moz-outline-radius: 10px;
    -webkit-outline-radius: 10px;
  }

  .text-footer {
    font-size: 65%;
  }

  #map {
    height: 85%;
    width: 100%;
  }

</style>
</head>

<body>  
 <!-- Navigation -->
 <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">      
  <a class="navbar-brand" href="#">
    <img src="logo.png" width="150" height="43" alt="">
  </a>    

  <div class="ml-auto text-white">Link Status: <span id="onlineStatus"><span class="text-warning">Connecting...</span></span><br>
   <span class="text-white">Last Contact:  <span id="timeStamp" ><span class="text-warning">unknown</span></span></div></span>
 </nav>

 <div class="row">
  <div id = "alt" class="col-sm-4 col-centered">0 ft</div>
  <div id = "hdg" class="col-sm-4 col-centered">5°</div>
  <div id = "spd" class="col-sm-4 col-centered">0 kt</div>
</div>

<div id="map"></div> 


<div class="row-light text-footer">
  <div id = "alt" class="col-sm-12">Designed and built at ASFM's Humberto Lobo Morales STEM LAB in Monterrey Mexico. Jan/2018 - Follow us on <a href="https://www.instagram.com/asfmstemlab/">Instagram</a></div>  
</div>




<script>
  var uluru = {lat: -25.363, lng: 131.044};
  var map;    
  var marker;   

  function initMap() {      
    map = new google.maps.Map(document.getElementById('map'), {
      zoom: 16,
      center: uluru        
    });

    self.map = map;

    var image = {
      url: 'capsule.png',            
      size: new google.maps.Size(50, 93),
      scaledSize: new google.maps.Size(50, 93),
      origin: new google.maps.Point(0, 0),    
      anchor: new google.maps.Point(0, 60)
    };

    marker = new google.maps.Marker({
      position: uluru,
      icon: image, 
      animation: google.maps.Animation.DROP,
      title: 'HLM-1',       
      map: map        
    });
  }

  function updatePosition(lat, lon) {           
    myLatlng = new google.maps.LatLng(lat, lon);                
    marker.setPosition(myLatlng);      
    map.panTo(myLatlng);
  }  

</script>

<script async defer
src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD8gfYbAdrmv31wjFhNZVtmIY6FWhenqLw&callback=initMap">
</script>


<script src="./socket.io.js"></script>

<script>
  var socket = io('http://movic.io:4200');
  socket.on('connect', function(){    
    document.getElementById("onlineStatus").innerHTML = "<span class='text-success'>Online</span>";        
    socket.emit('POS', '', (data) => {
     updateAllData(data);
   });    
  });

  socket.on('POS', function(data){
   updateAllData(data);   
 });

  socket.on('disconnect', function(){
    document.getElementById("onlineStatus").innerHTML = "Offline";    
    message("Houston we have a problem!.. Something happened with the internet connection or with the server, we lost coms!")
  });

  function updateAllData(data) {
   updatePosition(parseFloat(data.lat), parseFloat(data.lon));
   var alt = new Intl.NumberFormat().format(data.alt);
   var timeStampString = data.timeStamp;  
   document.getElementById("alt").innerHTML = alt + " ft";   
   document.getElementById("hdg").innerHTML = data.hdg + "°";   
   document.getElementById("spd").innerHTML = data.spd + " kt";           
   document.getElementById("timeStamp").innerHTML = "<span class='text-success'>" + timeStampString +"</span>";
 }

  function message($message) {
    alert($message);
  }

</script>

</body>
</html>